<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.93.0" />
<meta name="robots" content="index, follow">

<script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "WebSite",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/awslabs.github.io\/kubeflow-manifests\/"
      },
      "articleSection" : "docs",
      "name" : "FSx for Lustre",
      "headline" : "FSx for Lustre",
      "description" : "Use Amazon FSx as persistent storage with Kubeflow on AWS",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "0001",
      "datePublished": "0001-01-01 00:00:00 \u002b0000 UTC",
      "dateModified" : "0001-01-01 00:00:00 \u002b0000 UTC",
      "url" : "https:\/\/awslabs.github.io\/kubeflow-manifests\/docs\/deployment\/install\/add-ons\/storage\/fsx-for-lustre\/guide\/",
      "wordCount" : "1588",
      "keywords" : [ "Kubeflow" ]
  }
  </script>

<link rel="shortcut icon" href="/kubeflow-manifests/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kubeflow-manifests/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kubeflow-manifests/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kubeflow-manifests/favicons/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/kubeflow-manifests/favicons/manifest.json">
<meta name="msapplication-config" content="/kubeflow-manifests/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#4279f4">
<meta name="theme-color" content="#4279f4">

<title>FSx for Lustre | Kubeflow on AWS</title>
<meta name="description" content="Use Amazon FSx as persistent storage with Kubeflow on AWS">
<meta property="og:title" content="FSx for Lustre" />
<meta property="og:description" content="Use Amazon FSx as persistent storage with Kubeflow on AWS" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://awslabs.github.io/kubeflow-manifests/docs/deployment/install/add-ons/storage/fsx-for-lustre/guide/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2022-04-19T18:52:20-07:00" /><meta property="og:site_name" content="Kubeflow on AWS" />

<meta itemprop="name" content="FSx for Lustre">
<meta itemprop="description" content="Use Amazon FSx as persistent storage with Kubeflow on AWS">
<meta itemprop="dateModified" content="2022-04-19T18:52:20-07:00" />
<meta itemprop="wordCount" content="1588">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="FSx for Lustre"/>
<meta name="twitter:description" content="Use Amazon FSx as persistent storage with Kubeflow on AWS"/>




<link rel="preload" href="/kubeflow-manifests/scss/main.min.b275c0f5fd67c46ede305b867783e2f2c77df1c8e5b6fa9630975c6588ebfe2b.css" as="style">
<link href="/kubeflow-manifests/scss/main.min.b275c0f5fd67c46ede305b867783e2f2c77df1c8e5b6fa9630975c6588ebfe2b.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-135379910-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand-md navbar-dark  td-navbar">
        <a class="navbar-brand" href="/kubeflow-manifests/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">Kubeflow on AWS</span>
	</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main_navbar" aria-controls="main_navbar" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse ml-md-auto" id="main_navbar">
		<ul class="navbar-nav ml-auto pt-4 pt-md-0 my-2 my-md-1">
			
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/kubeflow-manifests/docs/" ><i class='fas fa-book pr-2'></i><span>Documentation</span></a>
			</li>
			
			<li class="nav-item mr-2 mr-lg-4 mt-1 mt-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/awslabs/kubeflow-manifests" target="_blank" ><i class='fab fa-github pr-2'></i><span>GitHub</span></a>
			</li>
			
			
			<li class="nav-item dropdown mt-1 mt-lg-0 mr-2">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu dropdown-menu-md-right dropdown-menu-lg-left" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://awslabs.github.io/kubeflow-manifests/docs">1.4</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    <input type="search" class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete="off">

    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="collapse td-sidebar-nav foldable-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-kubeflow-manifestsdocs-li">
  <a href="/kubeflow-manifests/docs/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-kubeflow-manifestsdocs"><span class="">Documentation</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-kubeflow-manifestsdocsabout-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsabout-check"/>
  <label for="m-kubeflow-manifestsdocsabout-check"><a href="/kubeflow-manifests/docs/about/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-kubeflow-manifestsdocsabout"><span class="">About</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsaboutfeatures-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsaboutfeatures-check"/>
  <label for="m-kubeflow-manifestsdocsaboutfeatures-check"><a href="/kubeflow-manifests/docs/about/features/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsaboutfeatures"><span class="">AWS Features for Kubeflow</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsaboutreleases-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsaboutreleases-check"/>
  <label for="m-kubeflow-manifestsdocsaboutreleases-check"><a href="/kubeflow-manifests/docs/about/releases/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsaboutreleases"><span class="">Releases and Versioning</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsabouteks-compatibility-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsabouteks-compatibility-check"/>
  <label for="m-kubeflow-manifestsdocsabouteks-compatibility-check"><a href="/kubeflow-manifests/docs/about/eks-compatibility/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsabouteks-compatibility"><span class="">Amazon EKS and Kubeflow Compatibility</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsaboutsecurity-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsaboutsecurity-check"/>
  <label for="m-kubeflow-manifestsdocsaboutsecurity-check"><a href="/kubeflow-manifests/docs/about/security/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsaboutsecurity"><span class="">Security</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsaboutusage-tracking-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsaboutusage-tracking-check"/>
  <label for="m-kubeflow-manifestsdocsaboutusage-tracking-check"><a href="/kubeflow-manifests/docs/about/usage-tracking/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsaboutusage-tracking"><span class="">Usage Tracking</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-kubeflow-manifestsdocsdeployment-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeployment-check" checked/>
  <label for="m-kubeflow-manifestsdocsdeployment-check"><a href="/kubeflow-manifests/docs/deployment/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-kubeflow-manifestsdocsdeployment"><span class="">Deployment</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-kubeflow-manifestsdocsdeploymentinstall-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstall-check" checked/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstall-check"><a href="/kubeflow-manifests/docs/deployment/install/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-kubeflow-manifestsdocsdeploymentinstall"><span class="">Install Kubeflow</span></a></label>
  
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstallprerequisites-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstallprerequisites-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstallprerequisites-check"><a href="/kubeflow-manifests/docs/deployment/install/prerequisites/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstallprerequisites"><span class="">Prerequisites</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstallcognitoguide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstallcognitoguide-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstallcognitoguide-check"><a href="/kubeflow-manifests/docs/deployment/install/cognito/guide/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstallcognitoguide"><span class="">Cognito</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstallrds-s3guide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstallrds-s3guide-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstallrds-s3guide-check"><a href="/kubeflow-manifests/docs/deployment/install/rds-s3/guide/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstallrds-s3guide"><span class="">RDS and S3</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstallcognito-rds-s3guide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstallcognito-rds-s3guide-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstallcognito-rds-s3guide-check"><a href="/kubeflow-manifests/docs/deployment/install/cognito-rds-s3/guide/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstallcognito-rds-s3guide"><span class="">Cognito, RDS, and S3</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstallvanillaguide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstallvanillaguide-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstallvanillaguide-check"><a href="/kubeflow-manifests/docs/deployment/install/vanilla/guide/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstallvanillaguide"><span class="">Vanilla Installation</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-kubeflow-manifestsdocsdeploymentinstalladd-ons-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstalladd-ons-check" checked/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstalladd-ons-check"><a href="/kubeflow-manifests/docs/deployment/install/add-ons/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-kubeflow-manifestsdocsdeploymentinstalladd-ons"><span class="">Add-ons</span></a></label>
  
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstorageefsguide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstorageefsguide-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstorageefsguide-check"><a href="/kubeflow-manifests/docs/deployment/install/add-ons/storage/efs/guide/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstorageefsguide"><span class="">EFS</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstoragefsx-for-lustreguide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstoragefsx-for-lustreguide-check" checked/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstoragefsx-for-lustreguide-check"><a href="/kubeflow-manifests/docs/deployment/install/add-ons/storage/fsx-for-lustre/guide/" class="align-left pl-0  active td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsstoragefsx-for-lustreguide"><span class="td-sidebar-nav-active-item">FSx for Lustre</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onscloudwatchguide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onscloudwatchguide-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstalladd-onscloudwatchguide-check"><a href="/kubeflow-manifests/docs/deployment/install/add-ons/cloudwatch/guide/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onscloudwatchguide"><span class="">CloudWatch</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsload-balancerguide-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsload-balancerguide-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstalladd-onsload-balancerguide-check"><a href="/kubeflow-manifests/docs/deployment/install/add-ons/load-balancer/guide/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstalladd-onsload-balancerguide"><span class="">Load Balancer</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentinstallcognitoreadme-automated-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentinstallcognitoreadme-automated-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentinstallcognitoreadme-automated-check"><a href="/kubeflow-manifests/docs/deployment/install/cognito/readme-automated/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentinstallcognitoreadme-automated"><span class=""></span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocsdeploymentuninstall-kubeflow-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocsdeploymentuninstall-kubeflow-check"/>
  <label for="m-kubeflow-manifestsdocsdeploymentuninstall-kubeflow-check"><a href="/kubeflow-manifests/docs/deployment/uninstall-kubeflow/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocsdeploymentuninstall-kubeflow"><span class="">Uninstall Kubeflow</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-kubeflow-manifestsdocscomponent-guides-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocscomponent-guides-check"/>
  <label for="m-kubeflow-manifestsdocscomponent-guides-check"><a href="/kubeflow-manifests/docs/component-guides/" class="align-left pl-0  td-sidebar-link td-sidebar-link__section" id="m-kubeflow-manifestsdocscomponent-guides"><span class="">Component Guides</span></a></label>
  
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocscomponent-guidesnotebooks-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocscomponent-guidesnotebooks-check"/>
  <label for="m-kubeflow-manifestsdocscomponent-guidesnotebooks-check"><a href="/kubeflow-manifests/docs/component-guides/notebooks/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocscomponent-guidesnotebooks"><span class="">Notebooks</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocscomponent-guidespipelines-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocscomponent-guidespipelines-check"/>
  <label for="m-kubeflow-manifestsdocscomponent-guidespipelines-check"><a href="/kubeflow-manifests/docs/component-guides/pipelines/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocscomponent-guidespipelines"><span class="">Pipelines</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocscomponent-guideskserve-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocscomponent-guideskserve-check"/>
  <label for="m-kubeflow-manifestsdocscomponent-guideskserve-check"><a href="/kubeflow-manifests/docs/component-guides/kserve/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocscomponent-guideskserve"><span class="">KServe</span></a></label>
  
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocscomponent-guidesprofiles-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocscomponent-guidesprofiles-check"/>
  <label for="m-kubeflow-manifestsdocscomponent-guidesprofiles-check"><a href="/kubeflow-manifests/docs/component-guides/profiles/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocscomponent-guidesprofiles"><span class="">Profiles</span></a></label>
  
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-kubeflow-manifestsdocstroubleshooting-aws-li">
  <input type="checkbox" id="m-kubeflow-manifestsdocstroubleshooting-aws-check"/>
  <label for="m-kubeflow-manifestsdocstroubleshooting-aws-check"><a href="/kubeflow-manifests/docs/troubleshooting-aws/" class="align-left pl-0  td-sidebar-link td-sidebar-link__page" id="m-kubeflow-manifestsdocstroubleshooting-aws"><span class="">Troubleshooting</span></a></label>
  
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href="https://github.com/awslabs/kubeflow-manifests/docs/tree/master/content/en/docs/deployment/install/add-ons/storage/fsx-for-lustre/guide.md" class="td-page-meta--view" target="_blank" rel="noopener"><i class="fa fa-file-alt fa-fw"></i> View page source</a>
  <a href="https://github.com/awslabs/kubeflow-manifests/docs/edit/master/content/en/docs/deployment/install/add-ons/storage/fsx-for-lustre/guide.md" class="td-page-meta--edit" target="_blank" rel="noopener"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
  <a href="https://github.com/awslabs/kubeflow-manifests/docs/new/master/content/en/docs/deployment/install/add-ons/storage/fsx-for-lustre/guide.md?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child" target="_blank" rel="noopener"><i class="fa fa-edit fa-fw"></i> Create child page</a>
  <a href="https://github.com/awslabs/kubeflow-manifests/docs/issues/new?title=FSx%20for%20Lustre" class="td-page-meta--issue" target="_blank" rel="noopener"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
  <a href="https://github.com/awslabs/kubeflow-manifests/issues/new" class="td-page-meta--project-issue" target="_blank" rel="noopener"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
  
</div>

            


<div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#10-prerequisites">1.0 Prerequisites</a></li>
    <li><a href="#20-setup-fsx-for-lustre">2.0 Setup FSx for Lustre</a>
      <ul>
        <li><a href="#21-option-1-automated-setup">2.1 [Option 1] Automated setup</a></li>
        <li><a href="#22-option-2-manual-setup">2.2 [Option 2] Manual setup</a></li>
      </ul>
    </li>
    <li><a href="#30-using-fsx-storage-in-kubeflow">3.0 Using FSx Storage in Kubeflow</a>
      <ul>
        <li><a href="#31-using-fsx-volume-as-workspace-or-data-volume-for-a-notebook-server">3.1 Using FSx volume as workspace or data volume for a notebook server</a></li>
        <li><a href="#note-about-permissions">Note about Permissions</a></li>
        <li><a href="#32-using-fsx-volume-for-a-trainingjob-using-tfjob-operator">3.2 Using FSx volume for a TrainingJob using TFJob Operator</a></li>
        <li><a href="#1-download-the-dataset-to-the-fsx-volume">1. Download the dataset to the FSx Volume</a></li>
        <li><a href="#2-build-and-push-the-docker-image">2. Build and Push the Docker image</a></li>
        <li><a href="#3-configure-the-tfjob-spec-file">3. Configure the tfjob spec file</a></li>
        <li><a href="#3-create-the-tfjob-and-use-the-provided-commands-to-check-the-training-logs">3. Create the TFjob and use the provided commands to check the training logs</a></li>
      </ul>
    </li>
    <li><a href="#60-cleanup">6.0 Cleanup</a>
      <ul>
        <li><a href="#61-clean-up-the-tfjob">6.1 Clean up the TFJob</a></li>
        <li><a href="#62-delete-the-kubeflow-notebook">6.2 Delete the Kubeflow Notebook</a></li>
        <li><a href="#63-delete-pvc-pv-and-sc-in-the-following-order">6.3 Delete PVC, PV and SC in the following order</a></li>
        <li><a href="#64-delete-the-fsx-filesystem">6.4 Delete the FSx filesystem</a></li>
      </ul>
    </li>
  </ul>
</nav></div>



            

	
		



  
  

	
		



  
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="https://awslabs.github.io/kubeflow-manifests/docs/">Documentation</a>
  </li>
  <li class="breadcrumb-item">
    <a href="https://awslabs.github.io/kubeflow-manifests/docs/deployment/">Deployment</a>
  </li>
  <li class="breadcrumb-item">
    <a href="https://awslabs.github.io/kubeflow-manifests/docs/deployment/install/">Install Kubeflow</a>
  </li>
  <li class="breadcrumb-item">
    <a href="https://awslabs.github.io/kubeflow-manifests/docs/deployment/install/add-ons/">Add-ons</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="https://awslabs.github.io/kubeflow-manifests/docs/deployment/install/add-ons/storage/fsx-for-lustre/guide/">FSx for Lustre</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>FSx for Lustre</h1>
	<div class="lead">Use Amazon FSx as persistent storage with Kubeflow on AWS</div>
	<header class="article-meta">
		

  
    


  
    


  

		
	</header>    
	<p>This guide describes how to use Amazon FSx as Persistent storage on top of an existing Kubeflow deployment.</p>
<h2 id="10-prerequisites">1.0 Prerequisites</h2>
<ol>
<li>
<p>For this README, we will assume that you already have an EKS Cluster with Kubeflow installed since the FSx CSI Driver can be installed and configured as a separate resource on top of an existing Kubeflow deployment. You can follow any of the other guides to complete these steps - choose one of the <a href="../../../README.md#deployment-options">AWS managed service integrated offering</a> or <a href="../../../vanilla/README.md">vanilla distribution</a>.</p>
</li>
<li>
<p>At this point, you have likely cloned this repo and checked out the right branch. Navigate to the current directory -</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cd kubeflow-manifests/distributions/aws/examples/storage
</span></span></code></pre></div><ol start="3">
<li>Make sure the following environment variables are set.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>export CLUSTER_NAME=&lt;clustername&gt;
</span></span><span style="display:flex;"><span>export CLUSTER_REGION=&lt;clusterregion&gt;
</span></span><span style="display:flex;"><span>export AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query &#34;Account&#34; --output text)
</span></span></code></pre></div><h2 id="20-setup-fsx-for-lustre">2.0 Setup FSx for Lustre</h2>
<p>You can either use Automated or Manual setup</p>
<h3 id="21-option-1-automated-setup">2.1 [Option 1] Automated setup</h3>
<p>The script automates all the Manual steps.<br>
It performs the required cluster configuration, creates an FSx file system and it also takes care of creating a storage class for static provisioning.</p>
<ol>
<li>Install the script dependencies <code>pip install -r requirements.txt</code></li>
<li>Run the script from the <code>tests/e2e</code> directory -</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>python utils/auto-fsx-setup.py --region $CLUSTER_REGION --cluster $CLUSTER_NAME
</span></span></code></pre></div><h4 id="advanced-customization"><strong>Advanced customization</strong></h4>
<p>The script applies some default values for the file system name, performance mode etc. If you know what you are doing, you can see which options are customizable by executing <code>python utils/auto-efs-setup.py --help</code>.</p>
<h3 id="22-option-2-manual-setup">2.2 [Option 2] Manual setup</h3>
<h4 id="1-install-the-fsx-csi-driver">1. Install the FSx CSI Driver</h4>
<p>We recommend installing the FSx CSI Driver v0.7.1 directly from the <a href="https://github.com/kubernetes-sigs/aws-fsx-csi-driver">the aws-fsx-csi-driver github repo</a> as follows -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl apply -k &#34;github.com/kubernetes-sigs/aws-fsx-csi-driver/deploy/kubernetes/overlays/stable/?ref=tags/v0.7.1&#34;
</span></span></code></pre></div><p>You can confirm that FSx CSI Driver was installed using the following command -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl get csidriver -A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME              ATTACHREQUIRED   PODINFOONMOUNT   MODES        AGE
</span></span><span style="display:flex;"><span>fsx.csi.aws.com   false            false            Persistent   14s
</span></span></code></pre></div><h4 id="2-create-the-iam-policy-for-the-csi-driver">2. Create the IAM Policy for the CSI Driver</h4>
<p>The CSI driver&rsquo;s service account (created during installation) requires IAM permission to make calls to AWS APIs on your behalf. Here, we will be annotating the Service Account <code>fsx-csi-controller-sa</code> with an IAM Role which has the required permissions.</p>
<ol>
<li>Create the policy using the json file provided as follows -</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>aws iam create-policy \
</span></span><span style="display:flex;"><span>    --policy-name Amazon_FSx_Lustre_CSI_Driver \
</span></span><span style="display:flex;"><span>    --policy-document file://fsx-for-lustre/fsx-csi-driver-policy.json
</span></span></code></pre></div><ol start="2">
<li>Create an IAM role and attach the IAM policy to it. Annotate the Kubernetes service account with the IAM role ARN and the IAM role with the Kubernetes service account name. You can create the role using eksctl as follows -</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>eksctl create iamserviceaccount \
</span></span><span style="display:flex;"><span>    --name fsx-csi-controller-sa \
</span></span><span style="display:flex;"><span>    --namespace kube-system \
</span></span><span style="display:flex;"><span>    --cluster $CLUSTER_NAME \
</span></span><span style="display:flex;"><span>    --attach-policy-arn arn:aws:iam::$AWS_ACCOUNT_ID:policy/Amazon_FSx_Lustre_CSI_Driver \
</span></span><span style="display:flex;"><span>    --region $CLUSTER_REGION \
</span></span><span style="display:flex;"><span>    --approve \
</span></span><span style="display:flex;"><span>    --override-existing-serviceaccounts 
</span></span></code></pre></div><ol start="3">
<li>You can verify by describing the specified service account to check if it has been correctly annotated -</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl describe -n kube-system serviceaccount fsx-csi-controller-sa
</span></span></code></pre></div><h4 id="3-create-an-instance-of-the-fsx-filesystem">3. Create an Instance of the FSx Filesystem</h4>
<p>Please refer to the official <a href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/getting-started-step1.html">AWS FSx CSI Document</a> for detailed instructions on creating an FSx filesystem.</p>
<p>Note: For this README, we have assumed that you are creating your FSx Filesystem in the same VPC as your EKS Cluster.</p>
<h4 id="4-static-provisioning">4. Static Provisioning</h4>
<p><a href="https://www.kubeflow.org/docs/distributions/aws/customizing-aws/storage/#amazon-fsx-for-lustre">Using this sample from official Kubeflow Docs</a></p>
<ol>
<li>Use the AWS Console to get the filesystem id of the FSx volume you want to use. You could also use the following command to list all the volumes available in your region. Either way, make sure that <code>file_system_id</code> is set.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>aws fsx describe-file-systems --query &#34;FileSystems[*].FileSystemId&#34; --output text --region $CLUSTER_REGION
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>export file_system_id=&lt;fsx-id-to-use&gt;
</span></span></code></pre></div><ol start="2">
<li>Once you have the filesystem id, Use the following command to retrieve DNSName, and MountName values.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>export dns_name=$(aws fsx describe-file-systems --file-system-ids $file_system_id --query &#34;FileSystems[0].DNSName&#34; --output text --region $CLUSTER_REGION)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export mount_name=$(aws fsx describe-file-systems --file-system-ids $file_system_id --query &#34;FileSystems[0].LustreConfiguration.MountName&#34; --output text --region $CLUSTER_REGION)
</span></span></code></pre></div><ol start="3">
<li>Now edit the <code>fsx-for-lustre/static-provisioning/pv.yaml</code> to replace &lt;file_system_id&gt;, &lt;dns_name&gt;, and &lt;mount_name&gt; with your values.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>yq e &#39;.spec.csi.volumeHandle = env(file_system_id)&#39; -i fsx-for-lustre/static-provisioning/pv.yaml
</span></span><span style="display:flex;"><span>yq e &#39;.spec.csi.volumeAttributes.dnsname = env(dns_name)&#39; -i fsx-for-lustre/static-provisioning/pv.yaml
</span></span><span style="display:flex;"><span>yq e &#39;.spec.csi.volumeAttributes.mountname = env(mount_name)&#39; -i fsx-for-lustre/static-provisioning/pv.yaml
</span></span></code></pre></div><ol start="4">
<li>The <code>PersistentVolume</code> is a cluster scoped resource but the <code>PersistentVolumeClaim</code> needs to be in the namespace you will be accessing it from. Replace the <code>kubeflow-user-example-com</code> namespace specified the below with the namespace for your kubeflow user and edit the <code>fsx-for-lustre/static-provisioning/pvc.yaml</code> file accordingly.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>export PVC_NAMESPACE=kubeflow-user-example-com
</span></span><span style="display:flex;"><span>yq e &#39;.metadata.namespace = env(PVC_NAMESPACE)&#39; -i fsx-for-lustre/static-provisioning/pvc.yaml
</span></span></code></pre></div><ol start="5">
<li>Now create the required <code>PersistentVolume</code> and <code>PersistentVolumeClaim</code> resources as -</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl apply -f fsx-for-lustre/static-provisioning/pv.yaml
</span></span><span style="display:flex;"><span>kubectl apply -f fsx-for-lustre/static-provisioning/pvc.yaml
</span></span></code></pre></div><ol start="6">
<li>Check your Setup
Use the following commands to ensure all resources have been deployed as expected and the PersistentVolume is correctly bound to the PersistentVolumeClaim</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl get pv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME    CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                 STORAGECLASS   REASON   AGE
</span></span><span style="display:flex;"><span>fsx-pv  1200Gi     RWX            Recycle          Bound    kubeflow-user-example-com/fsx-claim                           11s
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl get pvc -n $PVC_NAMESPACE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME        STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
</span></span><span style="display:flex;"><span>fsx-claim   Bound    fsx-pv   1200Gi     RWX                           83s
</span></span></code></pre></div><p>Now, Port Forward as needed and Login to the Kubeflow dashboard. You can also check the <code>Volumes</code> tab in Kubeflow and you should be able to see your PVC is available for use within Kubeflow.
In the following two sections we will be using this PVC to create a notebook server with Amazon FSx mounted as the workspace volume, download training data into this filesystem and then deploy a TFJob to train a model using this data.</p>
<h2 id="30-using-fsx-storage-in-kubeflow">3.0 Using FSx Storage in Kubeflow</h2>
<h3 id="31-using-fsx-volume-as-workspace-or-data-volume-for-a-notebook-server">3.1 Using FSx volume as workspace or data volume for a notebook server</h3>
<p>Spin up a new Kubeflow notebook server and specify the name of the PVC to be used as the workspace volume or the data volume and specify your desired mount point. For our example here, we are using the AWS Optimized Tensorflow 2.6 CPU image provided in the notebook configuration options - <code>public.ecr.aws/c9e4w0g3/notebook-servers/jupyter-tensorflow</code>. Additionally, use the existing <code>fsx-claim</code> volume as the workspace volume at the default mount point <code>/home/jovyan</code>. The server might take a few minutes to come up.</p>
<p>In case the server does not start up in the expected time, do make sure to check -</p>
<ol>
<li>The Notebook Controller Logs</li>
<li>The specific notebook server instance pod&rsquo;s logs</li>
</ol>
<h3 id="note-about-permissions">Note about Permissions</h3>
<p>You might need to specify some additional directory permissions on your worker node before you can use these as mount points. By default, new Amazon FSx file systems are owned by root:root, and only the root user (UID 0) has read-write-execute permissions. If your containers are not running as root, you must change the Amazon FSx file system permissions to allow other users to modify the file system. The set-permission-job.yaml is an example of how you could set these permissions to be able to use the FSx as your workspace in your kubeflow notebook.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>export CLAIM_NAME=fsx-claim
</span></span><span style="display:flex;"><span>yq e &#39;.metadata.name = env(CLAIM_NAME)&#39; -i notebook-sample/set-permission-job.yaml
</span></span><span style="display:flex;"><span>yq e &#39;.metadata.namespace = env(PVC_NAMESPACE)&#39; -i notebook-sample/set-permission-job.yaml
</span></span><span style="display:flex;"><span>yq e &#39;.spec.template.spec.volumes[0].persistentVolumeClaim.claimName = env(CLAIM_NAME)&#39; -i notebook-sample/set-permission-job.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl apply -f notebook-sample/set-permission-job.yaml
</span></span></code></pre></div><h3 id="32-using-fsx-volume-for-a-trainingjob-using-tfjob-operator">3.2 Using FSx volume for a TrainingJob using TFJob Operator</h3>
<p>The following section re-uses the PVC and the Tensorflow Kubeflow Notebook created in the previous steps to download a dataset to the FSx Volume. Then we spin up a TFjob which runs a image classification job using the data from the shared volume.
Source: <a href="https://www.tensorflow.org/tutorials/load_data/images">https://www.tensorflow.org/tutorials/load_data/images</a></p>
<p>Note: The following steps are run from the terminal on your gateway node connected to your EKS cluster and not from the Kubeflow Notebook to test the PVC allowed sharing of data as expected.</p>
<h3 id="1-download-the-dataset-to-the-fsx-volume">1. Download the dataset to the FSx Volume</h3>
<p>In the Kubeflow Notebook created above, use the following snippet to download the data into the <code>/home/jovyan/.keras</code> directory (which is mounted onto the FSx Volume).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import pathlib
</span></span><span style="display:flex;"><span>import tensorflow as tf
</span></span><span style="display:flex;"><span>dataset_url = &#34;https://storage.googleapis.com/download.tensorflow.org/example_images/flower_photos.tgz&#34;
</span></span><span style="display:flex;"><span>data_dir = tf.keras.utils.get_file(origin=dataset_url,
</span></span><span style="display:flex;"><span>                                   fname=&#39;flower_photos&#39;,
</span></span><span style="display:flex;"><span>                                   untar=True)
</span></span><span style="display:flex;"><span>data_dir = pathlib.Path(data_dir)
</span></span></code></pre></div><h3 id="2-build-and-push-the-docker-image">2. Build and Push the Docker image</h3>
<p>In the <code>training-sample</code> directory, we have provided a sample training script and Dockerfile which you can use as follows to build a docker image. Be sure to point the <code>$IMAGE_URI</code> to your registry and specify an appropriate tag -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>export IMAGE_URI=&lt;dockerimage:tag&gt;
</span></span><span style="display:flex;"><span>cd training-sample
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># You will need to login to ECR for the following steps
</span></span><span style="display:flex;"><span>docker build -t $IMAGE_URI .
</span></span><span style="display:flex;"><span>docker push $IMAGE_URI
</span></span><span style="display:flex;"><span>cd -
</span></span></code></pre></div><h3 id="3-configure-the-tfjob-spec-file">3. Configure the tfjob spec file</h3>
<p>Once the docker image is built, replace the <code>&lt;dockerimage:tag&gt;</code> in the <code>tfjob.yaml</code> file, line #17.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>yq e &#39;.spec.tfReplicaSpecs.Worker.template.spec.containers[0].image = env(IMAGE_URI)&#39; -i training-sample/tfjob.yaml
</span></span></code></pre></div><p>Also, specify the name of the PVC you created -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>export CLAIM_NAME=fsx-claim
</span></span><span style="display:flex;"><span>yq e &#39;.spec.tfReplicaSpecs.Worker.template.spec.volumes[0].persistentVolumeClaim.claimName = env(CLAIM_NAME)&#39; -i training-sample/tfjob.yaml
</span></span></code></pre></div><p>Make sure to run it in the same namespace as the claim -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>yq e &#39;.metadata.namespace = env(PVC_NAMESPACE)&#39; -i training-sample/tfjob.yaml
</span></span></code></pre></div><h3 id="3-create-the-tfjob-and-use-the-provided-commands-to-check-the-training-logs">3. Create the TFjob and use the provided commands to check the training logs</h3>
<p>At this point, we are ready to train the model using the <code>training-sample/training.py</code> script and the data available on the shared volume with the Kubeflow TFJob operator as -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl apply -f training-sample/tfjob.yaml
</span></span></code></pre></div><p>In order to check that the training job is running as expected, you can check the events in the TFJob describe response as well as the job logs as -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl describe tfjob image-classification-pvc -n $PVC_NAMESPACE
</span></span><span style="display:flex;"><span>kubectl logs -n $PVC_NAMESPACE image-classification-pvc-worker-0 -f
</span></span></code></pre></div><h2 id="60-cleanup">6.0 Cleanup</h2>
<p>This section cleans up the resources created in this README, to cleanup other resources such as the Kubeflow deployment, please refer to the high level README files.</p>
<h3 id="61-clean-up-the-tfjob">6.1 Clean up the TFJob</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl delete tfjob -n $PVC_NAMESPACE image-classification-pvc
</span></span></code></pre></div><h3 id="62-delete-the-kubeflow-notebook">6.2 Delete the Kubeflow Notebook</h3>
<p>Login to the dashboard to stop and/or terminate any kubeflow notebooks you created for this session or use the following command -</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl delete notebook -n $PVC_NAMESPACE &lt;notebook-name&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl delete pod -n $PVC_NAMESPACE $CLAIM_NAME
</span></span></code></pre></div><h3 id="63-delete-pvc-pv-and-sc-in-the-following-order">6.3 Delete PVC, PV and SC in the following order</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>kubectl delete pvc -n $PVC_NAMESPACE $CLAIM_NAME
</span></span><span style="display:flex;"><span>kubectl delete pv fsx-pv
</span></span></code></pre></div><h3 id="64-delete-the-fsx-filesystem">6.4 Delete the FSx filesystem</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>aws fsx delete-file-system --file-system-id $file_system_id
</span></span></code></pre></div><p>Make sure to delete any other resources you have created such as security groups via the AWS Console or using awscli.</p>

	
		<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div class="card mt-4 col-12 col-sm-6">
  <div class="card-body">
    <h3 class="card-title">Feedback</h3>
    <p class="card-text">Was this page helpful?</p>
    <button class="btn btn-primary feedback--answer feedback--answer-yes" style="width: 5rem;">Yes</button>
    <button class="btn btn-primary feedback--answer feedback--answer-no" style="width: 5rem;">No</button>
    <p class="feedback--response feedback--response-yes">
      Glad to hear it! Please <a href="https://github.com/awslabs/kubeflow-manifests/issues/new?assignees=&labels=documentation&template=documentation-request.md&title=">tell us how we can improve</a>.
    </p>
    <p class="feedback--response feedback--response-no">
      Sorry to hear that. Please <a href="https://github.com/awslabs/kubeflow-manifests/issues/new?assignees=&labels=documentation&template=documentation-request.md&title=">tell us how we can improve</a>.
    </p>
  </div>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof ga !== 'function') return;
    const args = {
      command: 'send',
      hitType: 'event',
      category: 'Helpful',
      action: 'click',
      label: window.location.pathname,
      value: value
    };
    ga(args.command, args.hitType, args.category, args.action, args.label, args.value);
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(1);
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>

		<br />
	
	
	<div class="text-muted mt-5 pt-3 border-top">
  Last modified April 19, 2022: <a href="https://github.com/awslabs/kubeflow-manifests/docs/commit/cf54c93b4cfbf5c376b65f450f695077711deb84">Added Profiles component guide (cf54c93)</a>
</div>

</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark pt-3 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Kubeflow on AWS Authors.</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/kubeflow-manifests/js/tabpane-persist.js'></script>


















<script src="/kubeflow-manifests/js/main.min.d33ba880dcae2a9badacbf2fb5e36200904b2b546035ace68e637312fcf7d133.js" integrity="sha256-0zuogNyuKputrL8vteNiAJBLK1RgNazmjmNzEvz30TM=" crossorigin="anonymous"></script>




  </body>
</html>